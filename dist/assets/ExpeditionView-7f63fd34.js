import{R as k,v as p,j as e,r as q,f as D}from"./index-18808fcb.js";import{B as O,a as $}from"./BotonConTooltip-fccefd16.js";import{u as P}from"./useDragToScroll-43b99b71.js";const S=({completionTimestamp:m})=>{const[d,c]=q.useState(m-Date.now());q.useEffect(()=>{const R=setInterval(()=>{c(v=>Math.max(0,v-1e3))},1e3);return()=>clearInterval(R)},[]);const o=Math.floor(d/6e4),f=Math.floor(d%6e4/1e3);return e.jsxs("span",{children:[o,"m ",f,"s"]})},w={scrap:{name:"Chatarra"},metalRefinado:{name:"Metal Refinado"},aceroEstructural:{name:"Acero Estructural"},fragmentosPlaca:{name:"Fragmentos de Placa"},circuitosDañados:{name:"Circuitos Dañados"},aleacionReforzada:{name:"Aleación Reforzada"},neuroChipCorrupto:{name:"Neuro-Chip Corrupto"}},U=k.memo(({resources:m,drones:d,activeExpeditions:c,buyAmount:o,onStartExpedition:f,onClaimReward:R,onSetBuyAmount:v,onClose:I,gameState:h})=>{const y=P(),g={expeditionDrone:c.filter(i=>{var n;return((n=p.find(t=>t.id===i.id))==null?void 0:n.droneType)==="expeditionDrone"}).reduce((i,n)=>i+n.dronesSent,0),expeditionV2Drone:c.filter(i=>{var n;return((n=p.find(t=>t.id===i.id))==null?void 0:n.droneType)==="expeditionV2Drone"}).reduce((i,n)=>i+n.dronesSent,0)},b={expeditionDrone:d.expeditionDrone-g.expeditionDrone,expeditionV2Drone:d.expeditionV2Drone-g.expeditionV2Drone},B=p.filter(i=>i.tier===1),N=p.filter(i=>i.tier===2),C=i=>i.map(n=>{const t=!n.prerequisites||n.prerequisites(h),u=n.droneType,x=n.costs.drones,M=b[u];let l=0;if(t&&x>0){l=Math.floor(M/x);for(const[s,r]of Object.entries(n.costs)){if(s==="drones"||!r||r===0)continue;const a=m[s]??h.vindicator.bodegaResources[s]??0;l=Math.min(l,Math.floor(a/r))}}else if(t){let s=1/0;for(const[r,a]of Object.entries(n.costs)){if(r==="drones"||!a||a===0)continue;const j=m[r]??h.vindicator.bodegaResources[r]??0;s=Math.min(s,Math.floor(j/a))}l=s===1/0?1:s}const E=o==="max"?l>0?l:1:o,V=t&&(o==="max"?l>0:l>=o);return e.jsxs("div",{className:`expedition-item ${V?"":"unavailable"} ${t?"":"locked"}`,children:[e.jsx("h4",{children:n.title}),e.jsx("p",{children:n.description}),t?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Duración:"})," ",n.duration/60," minutos"]}),e.jsxs("div",{children:[e.jsxs("strong",{children:["Requisitos (x",o==="max"?l:o,"):"]}),e.jsxs("ul",{children:[x>0&&e.jsxs("li",{className:M>=x*E?"requirement met":"requirement unmet",children:[u==="expeditionV2Drone"?"Drones (DE-2):":"Drones (DE-1):"," ",D(x*E)]}),Object.entries(n.costs).map(([s,r])=>{if(s==="drones")return null;const a=(r||0)*E,T=(m[s]??h.vindicator.bodegaResources[s]??0)>=a,F=w[s]||{name:s};return e.jsxs("li",{className:T?"requirement met":"requirement unmet",children:[F.name,": ",D(a)]},s)})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Posibles Recompensas:"}),e.jsx("ul",{children:Object.entries(n.rewards).map(([s,r])=>{const a=w[s];if(!a)return null;const[j,T]=r;return e.jsxs("li",{children:[a.name,": ",D(j)," - ",D(T)]},s)})})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Riesgo:"})," ",n.risk.chance*100,"% de posibilidad de perder el dron."]}),e.jsxs("button",{onClick:()=>f(n.id,o),disabled:!V,className:"send-button",children:["Enviar ",o==="max"?`MAX (${l})`:o]})]}):e.jsx("div",{className:"requirement-warning",children:"⚠️ Requiere el Vindicator."})]},n.id)});return e.jsx("div",{className:"expedition-view-container",children:e.jsxs("div",{className:"expedition-content-area",ref:y,children:[e.jsx("button",{onClick:I,className:"close-button",children:"×"}),e.jsxs("div",{className:"fleet-status",children:[e.jsx("h3",{children:"Estado de la Flota de Expedición"}),e.jsxs("p",{children:["Drones de Expedición (DE-1) Disponibles: ",e.jsx("strong",{style:{color:"#22C55E"},children:b.expeditionDrone})," / ",d.expeditionDrone]}),e.jsxs("p",{children:["Drones de Expedición (DE-2) Disponibles: ",e.jsx("strong",{style:{color:"#10B981"},children:b.expeditionV2Drone})," / ",d.expeditionV2Drone]})]}),e.jsx(O,{buyAmount:o,onSetBuyAmount:v}),c.length>0&&e.jsxs("div",{className:"active-expeditions",children:[e.jsx("h3",{className:"section-title",children:"Expediciones en Curso"}),c.map(i=>{const n=p.find(u=>u.id===i.id);if(!n)return null;const t=i.completionTimestamp<=Date.now();return e.jsxs("div",{className:"expedition-item",children:[e.jsx("h4",{children:n.title}),e.jsxs("p",{children:[i.dronesSent," ",n.droneType==="expeditionV2Drone"?"Drones (DE-2)":"Drones (DE-1)"," enviados."]}),t?e.jsxs("div",{children:[e.jsx("p",{style:{color:"#22C55E"},children:"¡Expedición Completada!"}),e.jsx($,{onClick:()=>R(i),className:"claim-button",disabled:!1,tooltipText:"",children:"Reclamar Recompensa"})]}):e.jsxs("p",{children:["Tiempo Restante: ",e.jsx(S,{completionTimestamp:i.completionTimestamp})]})]},i.instanceId)})]}),e.jsxs("div",{className:"available-expeditions",children:[e.jsx("h3",{className:"section-title",children:"Destinos Disponibles - TIER 1"}),C(B),N.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"section-title tier2-title",children:"Destinos Disponibles - TIER 2"}),C(N)]})]})]})})});export{U as default};
