import{R as k,v as p,j as e,r as w,f as D}from"./index-6d3cdd80.js";import{B as O,a as $}from"./BotonConTooltip-58909d04.js";import{u as P}from"./useDragToScroll-d9863d94.js";const S=({completionTimestamp:c})=>{const[d,m]=w.useState(c-Date.now());if(w.useEffect(()=>{const R=setInterval(()=>{const h=c-Date.now();m(h>0?h:0)},1e3);return()=>clearInterval(R)},[c]),d<=0)return e.jsx("span",{children:"0m 0s"});const t=Math.floor(d/6e4),b=Math.floor(d%6e4/1e3);return e.jsxs("span",{children:[t,"m ",b,"s"]})},M={scrap:{name:"Chatarra"},metalRefinado:{name:"Metal Refinado"},aceroEstructural:{name:"Acero Estructural"},fragmentosPlaca:{name:"Fragmentos de Placa"},circuitosDañados:{name:"Circuitos Dañados"},aleacionReforzada:{name:"Aleación Reforzada"},neuroChipCorrupto:{name:"Neuro-Chip Corrupto"},barraCombustible:{name:"Barra de Combustible"}},U=k.memo(({resources:c,drones:d,activeExpeditions:m,buyAmount:t,onStartExpedition:b,onClaimReward:R,onSetBuyAmount:h,onClose:y,gameState:u})=>{const I=P(),E={expeditionDrone:m.filter(i=>{var n;return((n=p.find(o=>o.id===i.id))==null?void 0:n.droneType)==="expeditionDrone"}).reduce((i,n)=>i+n.dronesSent,0),expeditionV2Drone:m.filter(i=>{var n;return((n=p.find(o=>o.id===i.id))==null?void 0:n.droneType)==="expeditionV2Drone"}).reduce((i,n)=>i+n.dronesSent,0)},v={expeditionDrone:d.expeditionDrone-E.expeditionDrone,expeditionV2Drone:d.expeditionV2Drone-E.expeditionV2Drone},B=p.filter(i=>i.tier===1),N=p.filter(i=>i.tier===2),T=i=>i.map(n=>{const o=!n.prerequisites||n.prerequisites(u),j=n.droneType,x=n.costs.drones,V=v[j];let l=0;if(o&&x>0){l=Math.floor(V/x);for(const[s,r]of Object.entries(n.costs)){if(s==="drones"||!r||r===0)continue;const a=c[s]??u.vindicator.bodegaResources[s]??0;l=Math.min(l,Math.floor(a/r))}}else if(o){let s=1/0;for(const[r,a]of Object.entries(n.costs)){if(r==="drones"||!a||a===0)continue;const f=c[r]??u.vindicator.bodegaResources[r]??0;s=Math.min(s,Math.floor(f/a))}l=s===1/0?1:s}const g=t==="max"?l>0?l:1:t,q=o&&(t==="max"?l>0:l>=t);return e.jsxs("div",{className:`expedition-item ${q?"":"unavailable"} ${o?"":"locked"}`,children:[e.jsx("h4",{children:n.title}),e.jsx("p",{children:n.description}),o?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Duración:"})," ",n.duration/60," minutos"]}),e.jsxs("div",{children:[e.jsxs("strong",{children:["Requisitos (x",t==="max"?l:t,"):"]}),e.jsxs("ul",{children:[x>0&&e.jsxs("li",{className:V>=x*g?"requirement met":"requirement unmet",children:[j==="expeditionV2Drone"?"Drones (DE-2):":"Drones (DE-1):"," ",D(x*g)]}),Object.entries(n.costs).map(([s,r])=>{if(s==="drones")return null;const a=(r||0)*g,C=(c[s]??u.vindicator.bodegaResources[s]??0)>=a,F=M[s]||{name:s};return e.jsxs("li",{className:C?"requirement met":"requirement unmet",children:[F.name,": ",D(a)]},s)})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Posibles Recompensas:"}),e.jsx("ul",{children:Object.entries(n.rewards).map(([s,r])=>{const a=M[s];if(!a)return null;const[f,C]=r;return e.jsxs("li",{children:[a.name,": ",D(f)," - ",D(C)]},s)})})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Riesgo:"})," ",n.risk.chance*100,"% de posibilidad de perder el dron."]}),e.jsxs("button",{onClick:()=>b(n.id,t),disabled:!q,className:"send-button",children:["Enviar ",t==="max"?`MAX (${l})`:t]})]}):e.jsx("div",{className:"requirement-warning",children:"⚠️ Requiere el Vindicator."})]},n.id)});return e.jsx("div",{className:"expedition-view-container",children:e.jsxs("div",{className:"expedition-content-area",ref:I,children:[e.jsx("button",{onClick:y,className:"close-button",children:"×"}),e.jsxs("div",{className:"fleet-status",children:[e.jsx("h3",{children:"Estado de la Flota de Expedición"}),e.jsxs("p",{children:["Drones de Expedición (DE-1) Disponibles: ",e.jsx("strong",{style:{color:"#22C55E"},children:v.expeditionDrone})," / ",d.expeditionDrone]}),e.jsxs("p",{children:["Drones de Expedición (DE-2) Disponibles: ",e.jsx("strong",{style:{color:"#10B981"},children:v.expeditionV2Drone})," / ",d.expeditionV2Drone]})]}),e.jsx(O,{buyAmount:t,onSetBuyAmount:h}),m.length>0&&e.jsxs("div",{className:"active-expeditions",children:[e.jsx("h3",{className:"section-title",children:"Expediciones en Curso"}),m.map(i=>{const n=p.find(j=>j.id===i.id);if(!n)return null;const o=i.completionTimestamp<=Date.now();return e.jsxs("div",{className:"expedition-item",children:[e.jsx("h4",{children:n.title}),e.jsxs("p",{children:[i.dronesSent," ",n.droneType==="expeditionV2Drone"?"Drones (DE-2)":"Drones (DE-1)"," enviados."]}),o?e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("p",{style:{color:"#22C55E",margin:0},children:"¡Expedición Completada!"}),e.jsx($,{onClick:()=>R(i),className:"claim-button",disabled:!1,tooltipText:"",children:"Reclamar Recompensa"})]}):e.jsxs("p",{children:["Tiempo Restante: ",e.jsx(S,{completionTimestamp:i.completionTimestamp})]})]},i.instanceId)})]}),e.jsxs("div",{className:"available-expeditions",children:[e.jsx("h3",{className:"section-title",children:"Destinos Disponibles - TIER 1"}),T(B),N.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"section-title tier2-title",children:"Destinos Disponibles - TIER 2"}),T(N)]})]})]})})});export{U as default};
